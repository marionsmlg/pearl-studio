---
import Header from '../components/Header';
import StructuredData from '../components/StructuredData.astro';

interface Props {
  title: string;
  description?: string;
  image?: string;
  noindex?: boolean;
  structuredDataType?: 'home' | 'about' | 'portfolio';
}

const {
  title,
  description = "PEARL is a digital studio focused on clarity, intention, and longevity. We build websites that are carefully engineered, yet effortless on the surface.",
  image = "/images/pearl-background.webp",
  noindex = false,
  structuredDataType = 'home'
} = Astro.props;

const currentPath = Astro.url.pathname;
const siteUrl = Astro.site || 'https://pearl-agency.com';
const canonicalURL = new URL(Astro.url.pathname, siteUrl);
const ogImage = new URL(image, siteUrl);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    {noindex && <meta name="robots" content="noindex, nofollow" />}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={ogImage} />

    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Optimized font loading with display=swap -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

    <!-- Preload critical assets -->
    <link rel="preload" as="image" href="/images/pearl-background.webp" fetchpriority="high" />

    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#F8F9FA" />

    <!-- Structured Data -->
    <StructuredData type={structuredDataType} />
  </head>
  <body class="min-h-screen w-full relative selection:bg-rose-100 selection:text-graphite overflow-x-hidden">

    {/* Header - Using client:idle for better performance */}
    <div class="relative z-[100]">
      <Header client:idle currentPath={currentPath} />
    </div>

    {/* Main Content */}
    <main class="w-full relative z-10">
      <slot />
    </main>

    {/* Grain Overlay */}
    <div class="grain-overlay"></div>
  </body>
</html>

<style is:global>
  @tailwind base;
  @tailwind components;
  @tailwind utilities;

  body {
    background-color: #F8F9FA;
    color: #1E1F22;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow-x: hidden;
    margin: 0;
  }

  input {
    caret-color: #1E1F22;
  }

  ::-webkit-scrollbar {
    width: 0px;
    background: transparent;
  }

  /* Hide video controls completely - aggressive approach for Safari iOS */
  video {
    object-fit: cover;
  }

  video::-webkit-media-controls {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    -webkit-appearance: none !important;
  }

  video::-webkit-media-controls-enclosure {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
  }

  video::-webkit-media-controls-start-playback-button {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    -webkit-appearance: none !important;
  }

  video::-webkit-media-controls-play-button {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    -webkit-appearance: none !important;
  }

  video::-webkit-media-controls-panel {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
  }

  video::-webkit-media-controls-overlay-enclosure {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
  }

  video::-webkit-media-controls-overlay-play-button {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    -webkit-appearance: none !important;
  }

  /* Force video to not show any UI */
  video::cue {
    display: none !important;
  }

  /* Base Nacre Texture */
  #nacre-system {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: -1;
    overflow: hidden;
    pointer-events: none;
  }

  /* Nacre Sweep Effects - Subtle Pearlescent Reflections */
  .nacre-sweep-1 {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 200%;
    background: linear-gradient(
      135deg,
      transparent 0%,
      rgba(255, 255, 255, 0.1) 20%,
      rgba(248, 250, 252, 0.16) 35%,
      rgba(255, 255, 255, 0.2) 50%,
      rgba(248, 250, 252, 0.16) 65%,
      rgba(255, 255, 255, 0.1) 80%,
      transparent 100%
    );
    filter: blur(50px);
    mix-blend-mode: overlay;
    animation: nacreSweep1 12s ease-in-out infinite;
  }

  .nacre-sweep-2 {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 200%;
    background: linear-gradient(
      225deg,
      transparent 0%,
      rgba(255, 255, 255, 0.09) 20%,
      rgba(250, 251, 253, 0.14) 35%,
      rgba(255, 255, 255, 0.18) 50%,
      rgba(250, 251, 253, 0.14) 65%,
      rgba(255, 255, 255, 0.09) 80%,
      transparent 100%
    );
    filter: blur(55px);
    mix-blend-mode: overlay;
    animation: nacreSweep2 15s ease-in-out infinite;
  }

  /* Nacre Shimmer - Subtle floating glow */
  .nacre-shimmer {
    position: absolute;
    top: 20%;
    left: 20%;
    width: 60%;
    height: 60%;
    background: radial-gradient(
      ellipse at center,
      rgba(255, 255, 255, 0.15) 0%,
      rgba(252, 253, 254, 0.1) 25%,
      rgba(255, 255, 255, 0.05) 50%,
      transparent 75%
    );
    filter: blur(70px);
    mix-blend-mode: overlay;
    animation: nacreShimmer 8s ease-in-out infinite;
    opacity: 0.7;
  }

  /* Nacre Accent - Very subtle pearlescent hint */
  .nacre-accent {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80%;
    height: 80%;
    background: conic-gradient(
      from 0deg at 50% 50%,
      rgba(255, 255, 255, 0.06) 0deg,
      rgba(250, 252, 254, 0.09) 90deg,
      rgba(255, 255, 255, 0.07) 180deg,
      rgba(250, 252, 254, 0.09) 270deg,
      rgba(255, 255, 255, 0.06) 360deg
    );
    filter: blur(90px);
    mix-blend-mode: overlay;
    animation: nacreFloat 18s ease-in-out infinite;
    opacity: 0.8;
  }

  /* Micro Grain */
  .grain-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
    background-image: url("https://grainy-gradients.vercel.app/noise.svg");
    opacity: 0.04;
    mix-blend-mode: overlay;
  }

  html {
    scroll-behavior: smooth;
  }
</style>
